<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>py-Crawler | 8odream的小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Python作为一个”简单的”高级语言(尤其在爬虫领域享有盛名),有许多第三方库来帮助我们进行爬虫.爬虫,就是从互联网上获取定向的信息和数据,再进行分析和利用的方法.其中,bs4中的BeautifulSoup是一个分析网页内容的库,requests是一个从指定链接获取互联网内容的库.  下载bs4库  1pip3 install bs4   下载requests库  1pip3 install r">
<meta property="og:type" content="article">
<meta property="og:title" content="py-Crawler">
<meta property="og:url" content="https://8odream.github.io/Blog/2023/11/26/py-Crawler/index.html">
<meta property="og:site_name" content="8odream的小窝">
<meta property="og:description" content="Python作为一个”简单的”高级语言(尤其在爬虫领域享有盛名),有许多第三方库来帮助我们进行爬虫.爬虫,就是从互联网上获取定向的信息和数据,再进行分析和利用的方法.其中,bs4中的BeautifulSoup是一个分析网页内容的库,requests是一个从指定链接获取互联网内容的库.  下载bs4库  1pip3 install bs4   下载requests库  1pip3 install r">
<meta property="og:locale">
<meta property="og:image" content="https://8odream.github.io/Blog/source/images/%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5.png">
<meta property="og:image" content="https://8odream.github.io/images/%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A0.png">
<meta property="og:image" content="https://8odream.github.io/images/%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0.png">
<meta property="og:image" content="https://8odream.github.io/images/network.png">
<meta property="og:image" content="https://8odream.github.io/images/%E8%8E%B7%E5%8F%96UA.png">
<meta property="og:image" content="https://8odream.github.io/images/js%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%BE%97.png">
<meta property="og:image" content="https://8odream.github.io/images/%E4%B8%8B%E8%BD%BDurl%E7%BB%93%E6%9E%9C.png">
<meta property="article:published_time" content="2023-11-26T13:23:07.000Z">
<meta property="article:modified_time" content="2023-12-10T15:03:53.410Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="py">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://8odream.github.io/Blog/source/images/%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5.png">
  
    <link rel="alternate" href="/Blog/atom.xml" title="8odream的小窝" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/Blog/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/Blog/css/style.css">

  
    
<link rel="stylesheet" href="/Blog/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/Blog/" id="logo">8odream的小窝</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/Blog/">Home</a>
        
          <a class="main-nav-link" href="/Blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/Blog/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://8odream.github.io/Blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-py-Crawler" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/Blog/2023/11/26/py-Crawler/" class="article-date">
  <time class="dt-published" datetime="2023-11-26T13:23:07.000Z" itemprop="datePublished">2023-11-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      py-Crawler
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Python作为一个”简单的”高级语言(尤其在爬虫领域享有盛名),有许多第三方库来帮助我们进行爬虫.爬虫,就是从互联网上获取定向的信息和数据,再进行分析和利用的方法.其中,bs4中的<a target="_blank" rel="noopener" href="https://beautifulsoup.cn/">BeautifulSoup</a>是一个分析网页内容的库,requests是一个从指定链接获取互联网内容的库.</p>
<ul>
<li>下载bs4库</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install bs4</span><br></pre></td></tr></table></figure>

<ul>
<li>下载requests库</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install requests</span><br></pre></td></tr></table></figure>

<p>注意,如果下载速度很慢,记得去换成国内镜像源</p>
<h3 id="第一步-得到网页"><a href="#第一步-得到网页" class="headerlink" title="第一步:得到网页"></a>第一步:得到网页</h3><p>首先我们必须知道,传统的计算机是无法直接以人类的眼光来看待”网页”这一事物的.例如,相对位置、颜色、表格等,甚至不能正确处理未经过处理的文本信息.因此,网页实际上是由一个个”标签”组成的.例如,&lt;p&gt;&lt;&#x2F;p&gt;这一对标签,就是指出了这是一个”paragraph”(段落).计算机正是通过这一个个标签来分别处理不同的文字、图片等信息的.</p>
<p>我们为了处理网页,必须先得到网页本身.首先,我们必须得到网页的源代码,也就是带有标签信息的原始网页文件(.html).我们可以很方便的地使用requests库来得到这一源码.例如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">web=requests.get(&quot;https://www.baidu.com/&quot;)</span><br><span class="line">#web.encoding=&quot;UTF-8&quot;</span><br><span class="line">code_text=web.text  #.text参数获取源代码</span><br><span class="line"></span><br><span class="line">print(code_text)</span><br></pre></td></tr></table></figure>

<p>执行这段代码后的结果:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv=content-type content=text/html;charset=utf-8&gt;&lt;meta http-equiv=X-UA-Compatible content=IE=Edge&gt;&lt;meta content=always name=referrer&gt;&lt;link rel=stylesheet type=text/css href=https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/bdorz/baidu.min.css&gt;&lt;title&gt;ç¾åº¦ä¸ä¸ï¼ä½ å°±ç¥é&lt;/title&gt;&lt;/head&gt; &lt;body link=#0000cc&gt; &lt;div id=wrapper&gt; &lt;div id=head&gt; &lt;div class=head_wrapper&gt; &lt;div class=s_form&gt; &lt;div class=s_form_wrapper&gt; &lt;div id=lg&gt; &lt;img hidefocus=true src=//www.baidu.com/img/bd_logo1.png width=270 height=129&gt; &lt;/div&gt; &lt;form id=form name=f action=//www.baidu.com/s class=fm&gt; &lt;input type=hidden name=bdorz_come value=1&gt; &lt;input type=hidden name=ie value=utf-8&gt; &lt;input type=hidden name=f value=8&gt; &lt;input type=hidden name=rsv_bp value=1&gt; &lt;input type=hidden name=rsv_idx value=1&gt; &lt;input type=hidden name=tn value=baidu&gt;&lt;span class=&quot;bg s_ipt_wr&quot;&gt;&lt;input id=kw name=wd class=s_ipt value maxlength=255 autocomplete=off autofocus=autofocus&gt;&lt;/span&gt;&lt;span class=&quot;bg s_btn_wr&quot;&gt;&lt;input type=submit id=su value=ç¾åº¦ä¸ä¸ class=&quot;bg s_btn&quot; autofocus&gt;&lt;/span&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id=u1&gt; &lt;a href=http://news.baidu.com name=tj_trnews class=mnav&gt;æ°é»&lt;/a&gt; &lt;a href=https://www.hao123.com name=tj_trhao123 class=mnav&gt;hao123&lt;/a&gt; &lt;a href=http://map.baidu.com name=tj_trmap class=mnav&gt;å°å¾&lt;/a&gt; &lt;a href=http://v.baidu.com name=tj_trvideo class=mnav&gt;è§é¢&lt;/a&gt; &lt;a href=http://tieba.baidu.com name=tj_trtieba class=mnav&gt;è´´å§&lt;/a&gt; &lt;noscript&gt; &lt;a href=http://www.baidu.com/bdorz/login.gif?login&amp;amp;tpl=mn&amp;amp;u=http%3A%2F%2Fwww.baidu.com%2f%3fbdorz_come%3d1 name=tj_login class=lb&gt;ç»å½&lt;/a&gt; &lt;/noscript&gt; &lt;script&gt;document.write(&#x27;&lt;a href=&quot;http://www.baidu.com/bdorz/login.gif?login&amp;tpl=mn&amp;u=&#x27;+ encodeURIComponent(window.location.href+ (window.location.search === &quot;&quot; ? &quot;?&quot; : &quot;&amp;&quot;)+ &quot;bdorz_come=1&quot;)+ &#x27;&quot; name=&quot;tj_login&quot; class=&quot;lb&quot;&gt;ç»å½&lt;/a&gt;&#x27;);</span><br><span class="line">                &lt;/script&gt; &lt;a href=//www.baidu.com/more/ name=tj_briicon class=bri style=&quot;display: block;&quot;&gt;æ´å¤äº§å&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id=ftCon&gt; &lt;div id=ftConw&gt; &lt;p id=lh&gt; &lt;a href=http://home.baidu.com&gt;å³äºç¾åº¦&lt;/a&gt; &lt;a href=http://ir.baidu.com&gt;About Baidu&lt;/a&gt; &lt;/p&gt; &lt;p id=cp&gt;&amp;copy;2017&amp;nbsp;Baidu&amp;nbsp;&lt;a href=http://www.baidu.com/duty/&gt;ä½¿ç¨ç¾åº¦åå¿è¯»&lt;/a&gt;&amp;nbsp; &lt;a href=http://jianyi.baidu.com/ class=cp-feedback&gt;æè§åé¦&lt;/a&gt;&amp;nbsp;äº¬ICPè¯030173å·&amp;nbsp; &lt;img src=//www.baidu.com/img/gs.gif&gt; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>可以看到,这段结果非常混乱.主要有两个问题:</p>
<ul>
<li>返回的源代码没有正确换行</li>
<li>出现了特殊的字符乱码(实际上是中文)</li>
</ul>
<p>第二个问题实际上是编码的问题.我们取消代码中的注释,这表明以”UTF-8”这一字符编码标准进行解码,我们会发现这次它正确地返回了中文字符(这里输出结果省略).</p>
<p>但是第一个问题并没有得到解决.</p>
<p>我们加入BeautifulSoup这个库.这个库可以用来快速分析html的内容.<br>例如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from bs4 import BeautifulSoup </span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">web=requests.get(&quot;https://www.baidu.com/&quot;)</span><br><span class="line">web.encoding=&quot;UTF-8&quot;</span><br><span class="line">text=web.text  #.text参数获取源代码</span><br><span class="line"></span><br><span class="line">soup=BeautifulSoup(text,&quot;html.parser&quot;)  #&quot;html.parser&quot;是一个python自带的html分析器，用来正确解析html的内容。BeautifulSoup()返回一个BeautifulSoup对象。</span><br><span class="line"></span><br><span class="line">print(soup.prettify())  #.prettify()方法获取html的美化排版</span><br></pre></td></tr></table></figure>

<p>这次我们正确获得了正确的排版.实际上,对于html分析器,我们更推荐使用”lxml”而不是”html.parser”,因为前者的兼容性更好,速度也更快(注意需要另外下载和导入库).</p>
<h3 id="获取想要的内容-静态"><a href="#获取想要的内容-静态" class="headerlink" title="获取想要的内容(静态)"></a>获取想要的内容(静态)</h3><p>好吧,实际上,是否获得正确的排版对我们爬取内容无关.所以我们下面来讲一下爬取对应的内容.</p>
<p>网页的内容分为静态内容和动态内容.例如,<a target="_blank" rel="noopener" href="https://www.bilibili.com/">哔哩哔哩</a>首页推荐的时评内容是动态内容(不能固定).而像一些政府网站,例如<a target="_blank" rel="noopener" href="https://www.zjzs.net/moban/index/index.html">浙江省教育考试院</a>首页的内容就是静态内容,每次刷新我们都可以获得相同的内容.<img src="/Blog/source/images/%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5.png" alt="图片"></p>
<p>首先简单看一下如何手动查找html的内容.(下面以chrome浏览器为例.其他浏览器类似同理)</p>
<ul>
<li>找到你想要的网页,按下键盘的F12,打开浏览器的调试窗口<br><img src="/Blog/../images/%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A0.png" alt="图片"></li>
<li>点击左上角的箭头标志,然后鼠标点击网页中的对应内容.<br><img src="/Blog/../images/%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0.png" alt="图片"><br>可以看见右边的源代码中对应的标签被阴影化.这就是我们需要的内容了.</li>
</ul>
<p>对于静态网页,我们可以简单地分析html源代码来获取想要的文件.<br>以下是BeautifulSoup给出的一些简单的处理方法(具体的html概念可能需要另行了解)</p>
<p>获取标签的方法如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from bs4 import BeautifulSoup</span><br><span class="line"></span><br><span class="line">soup=BeautifulSoup(&quot;html.txt&quot;,&quot;lxml&quot;) #先导入网页源码</span><br><span class="line"></span><br><span class="line">tag=soup.a #返回文档里第一个超链接tag元素</span><br><span class="line"></span><br><span class="line">tags=soup.find_all(&quot;a&quot;) #a是html中的链接标签。这个语句获取所有超链接tag,按顺序返回一个列表，每个元素都是一个tag元素。下面的搜索方法也可以使用find_all方法</span><br><span class="line"></span><br><span class="line">tag=soup.find(&quot;a&quot;) #返回文档里第一个超链接tag元素</span><br><span class="line">tag=soup.find(class_=&quot;class0&quot;) #取第一个class值为“class0”的标签</span><br><span class="line">tag=soup.find(id=&quot;id0&quot;) #获取第一个id值为“id0”的标签</span><br><span class="line">tag=soup.find(attrs=&#123;&quot;id&quot;:&quot;id_1&quot;,&quot;class&quot;:&quot;style_1&quot;&#125;) #多条件需要使用attrs属性</span><br><span class="line"></span><br><span class="line">tags=soup.select(&quot;title&quot;) #按照标签查找</span><br><span class="line">tags=soup.select(&quot;.style1&quot;) #按照class查找</span><br><span class="line">tags=soup.select(&quot;#id0&quot;) #按照id查找</span><br><span class="line">tags=soup.select(&quot;p &gt; b&quot;) #按照父子关系查找</span><br><span class="line">tags=soup.select(&#x27;a[href=&quot;http://example.com/&quot;]&#x27;) #按照属性值查找。href的值是这个链接指向的网址</span><br><span class="line">#以上方法均可以以空格为间隔，混用输入多个要求来获得tag。返回值均为列表。</span><br></pre></td></tr></table></figure>

<p>tag的属性值:<br>假设该标签为:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;www.baidu.com&quot;</span> <span class="attr">class</span>=<span class="string">&quot;style_1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;id_1&quot;</span>&gt;</span>百度一下<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;tag.name</span><br><span class="line">a</span><br><span class="line">&gt;&gt;&gt;tag.attrs</span><br><span class="line">&#123;<span class="string">&#x27;href&#x27;</span>: <span class="string">&#x27;www.baidu.com&#x27;</span>, <span class="string">&#x27;class&#x27;</span>: [<span class="string">&#x27;style_1&#x27;</span>], <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;id_1&#x27;</span>&#125;</span><br><span class="line">&gt;&gt;&gt;tag.string</span><br><span class="line">百度一下</span><br></pre></td></tr></table></figure>

<p>可以用字典方法修改单个tag中attrs的某个属性.不存在的属性将被创建并赋值</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tag[<span class="string">&quot;class&quot;</span>]=<span class="string">&quot;stylecss&quot;</span> <span class="comment">#设置tag的标签属性。这里设置的是class属性。像这样能带有多个class值的属性，全部属性（包括只有一个时）以空格为间隔都会转化成列表的方式储存。可以直接赋值成多个值的列表</span></span><br></pre></td></tr></table></figure>

<p>当然,也可以直接用类的属性值直接更改整个tag</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tag.name=<span class="string">&quot;a_name&quot;</span> <span class="comment">#不建议，因为一般设置的name对html无效</span></span><br><span class="line">tag.atrrs=&#123;<span class="string">&#x27;class&#x27;</span>: [<span class="string">&#x27;style_1&#x27;</span>], <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;id_1&#x27;</span>&#125; <span class="comment">#注意，重新赋值的时候，没有手动赋值的内容将会被删除</span></span><br></pre></td></tr></table></figure>

<h3 id="反爬虫与反反爬虫"><a href="#反爬虫与反反爬虫" class="headerlink" title="反爬虫与反反爬虫"></a>反爬虫与反反爬虫</h3><p>事实上,为了确保用户数据的安全,网页的html源码往往只会给出一个基础框架而不包含数据.为了获得我们需要的数据,我们必须在合理的范围内对这种反爬虫进行突破.</p>
<p>事实上,有一个很简单且适用于大量小型网页的方法:伪装请求头(headers).这可以让服务器误以为是用户使用浏览器在获取数据,从而正常地来给用户发送需要的数据.需要注意的是,不同的浏览器有不同的UA,服务器发送的数据也不一定相同.比如iOS上Safari浏览器会引导用户到App Store上下载软件,而安卓系统往往会直接允许用户下载安装包等.</p>
<p>下面给出获得直接浏览器UA的办法:</p>
<ul>
<li>打开任意网页,按下键盘的F12,选中上方Network.<br><img src="/Blog/../images/network.png" alt="图片"></li>
<li>按下键盘的F5刷新页面.发现下方Name下出现大量数据.任意选中一个,在右侧的窗口上方选中Headers,再在下面中找到User-Agent变量.复制右侧的值即可.<br><img src="/Blog/../images/%E8%8E%B7%E5%8F%96UA.png" alt="图片"></li>
</ul>
<h3 id="获得动态的内容"><a href="#获得动态的内容" class="headerlink" title="获得动态的内容"></a>获得动态的内容</h3><p>动态的内容往往是使用js(JavaScript,一种编程语言)来逐一向服务器发送请求数据.这个时候,数据就不是存在原本html源码里了(这种情况下,html源码往往是个空壳),因此,当我们用上面的方法获取内容时,往往只能得到空的值或无效的值.</p>
<p>为了获得数据,我们必须找到请求真实数据的url.一般来说,我们可以以如下方法简单地进行手动查找:(以下以东方财富网的某个股票页面举例.当前页面时间为2023-12-10)</p>
<ul>
<li>打开F12,点击Network后刷新,获得全部的names</li>
<li>使用搜索功能,输入当前在页面上看到的涨跌数字</li>
<li>在下方的搜索结果中寻找”get”项下,带有当前时间的数据,点击后,在右侧的窗口中点击”Preview”.在下方的数据中尝试查看有效数据<br><img src="/Blog/../images/js%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%BE%97.png" alt="图片"></li>
</ul>
<p>可以看到很快就找到了我们需要的内容.一般来说,对于获取到的这样的”列表类”数据,我们需要使用json格式来处理,并且我们只需要简单地对比网页中的数据,就可以知道某个值的第几位是什么作用.</p>
<ul>
<li><p>此时点击中间names栏的选中值,这个就是我们需要的url.<br>事实上,即使我们在浏览器中打开这个url,并且显示的内容是一个网页,它也并非是一个网页.(怎么可能会有一个静态网页来储存动态数据呢?)其实,我们在下载器中下载这个地址,会发现下载的文件没有任何后缀名:<br><img src="/Blog/../images/%E4%B8%8B%E8%BD%BDurl%E7%BB%93%E6%9E%9C.png" alt="图片"></p>
</li>
<li><p>但是,我们可以用一些打开方式看到里面的数据(例如vscode),可以看到里面的数据和我们一开始在浏览器F12里看到的一致.这个时候我们就不需要使用bs4来处理网页的内容了.取而代之的,是json的分析方法.我们可以使用json模块对python的字符串进行处理,使之成为能够认读的json字符串.这种字符串可以以索引方式读写.<br>我们使用如下的函数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment">#example jsondata</span></span><br><span class="line">string=<span class="string">&#x27;&#x27;&#x27;[&#123;&quot;data1&quot;: &quot;value1&quot;, &quot;data2&quot;: &quot;value2&quot;&#125;,&#123;&quot;data1&quot;: &quot;value3&quot;,&quot;data2&quot;: &quot;value4&quot;&#125;]&#x27;&#x27;&#x27;</span> <span class="comment">#注意，在编写自己的数据的时候，内部的引号必须使用双引号，否则报错</span></span><br><span class="line">json_string=json.loads(string)</span><br><span class="line"><span class="built_in">print</span>(json_string[<span class="number">0</span>][<span class="string">&#x27;data1&#x27;</span>])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;value1</span><br></pre></td></tr></table></figure>
</li>
<li><p>但是,和传统的json格式不同,我们发现这个文件里的前面内容包含了”jQuery351049610706292989315_1702212722432”这样一串作为标记的噪音数据.我们需要先截取一段长度作为真正需要读取的字符串,然后进行处理.这个还挺简单的,我们按照长度截取就行.</p>
</li>
<li><p>同时,网页的开发者数据中很容易看出数据的包裹和分类情况(参见本小节图一)</p>
</li>
</ul>
<p>接下来使用requests和json模块处理,处理”浙能电力”这一股票:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&#x27;</span>&#125;</span><br><span class="line">web=requests.get(<span class="string">&quot;https://push2his.eastmoney.com/api/qt/stock/kline/get?cb=jQuery351049610706292989315_1702212722432&amp;secid=1.600023&amp;ut=fa5fd1943c7b386f172d6893dbfba10b&amp;fields1=f1%2Cf2%2Cf3%2Cf4%2Cf5%2Cf6&amp;fields2=f51%2Cf52%2Cf53%2Cf54%2Cf55%2Cf56%2Cf57%2Cf58%2Cf59%2Cf60%2Cf61&amp;klt=101&amp;fqt=1&amp;beg=0&amp;end=20500101&amp;smplmt=460&amp;lmt=1000000&amp;_=1702212722433&quot;</span>,headers=headers)</span><br><span class="line">web.encoding=<span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">text=web.text  <span class="comment">#.text参数获取源代码</span></span><br><span class="line"></span><br><span class="line">text_=json.loads(text[<span class="number">42</span>:-<span class="number">2</span>]) <span class="comment">#从第四十二位截断，去除噪音直到倒数第三位，去除多余的括号和分号</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>((text_[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;klines&quot;</span>][-<span class="number">1</span>]).split(<span class="string">&quot;,&quot;</span>)[<span class="number">3</span>]) <span class="comment">#获取最新的涨跌幅数据</span></span><br></pre></td></tr></table></figure>

<p>处理获取所有股票涨跌的实例:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">999999</span>+<span class="number">1</span>):</span><br><span class="line">    code=<span class="built_in">str</span>(<span class="string">&quot;%06d&quot;</span>%i)</span><br><span class="line">    web=requests.get(<span class="string">&quot;https://push2his.eastmoney.com/api/qt/stock/kline/get?cb=jQuery351049610706292989315_1702212722432&amp;secid=1.&quot;</span>+code+<span class="string">&quot;&amp;ut=fa5fd1943c7b386f172d6893dbfba10b&amp;fields1=f1%2Cf2%2Cf3%2Cf4%2Cf5%2Cf6&amp;fields2=f51%2Cf52%2Cf53%2Cf54%2Cf55%2Cf56%2Cf57%2Cf58%2Cf59%2Cf60%2Cf61&amp;klt=101&amp;fqt=1&amp;beg=0&amp;end=20500101&amp;smplmt=460&amp;lmt=1000000&amp;_=1702212722433&quot;</span>,headers=headers)</span><br><span class="line">    web.encoding=<span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">    text=web.text  <span class="comment">#.text参数获取源代码</span></span><br><span class="line"></span><br><span class="line">    text_=json.loads(text[<span class="number">42</span>:-<span class="number">2</span>]) <span class="comment">#从第四十二位截断，去除噪音直到倒数第三位，去除多余的括号和分号</span></span><br><span class="line"></span><br><span class="line">    check=<span class="built_in">len</span>(text) <span class="comment">#国债以及不存在的股票没有数据，跳过</span></span><br><span class="line">    <span class="keyword">if</span> check <span class="keyword">or</span> text_[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;klines&quot;</span>]==[]&lt;<span class="number">200</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    </span><br><span class="line">    flag=-<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">float</span>(text_[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;klines&quot;</span>][-<span class="number">1</span>].split(<span class="string">&quot;,&quot;</span>)[-<span class="number">2</span>])&gt;=<span class="number">0</span>:</span><br><span class="line">        flag=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;今日该代码:&quot;</span>,code,<span class="string">&quot;股票涨跌:&quot;</span>,<span class="built_in">float</span>(text_[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;klines&quot;</span>][-<span class="number">1</span>].split(<span class="string">&quot;,&quot;</span>)[<span class="number">3</span>])*flag)</span><br><span class="line">    time.sleep(<span class="number">1</span>) <span class="comment">#使用sleep防止被ban</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://8odream.github.io/Blog/2023/11/26/py-Crawler/" data-id="clpzm4hfq0000hc6z9tf05aui" data-title="py-Crawler" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/Blog/tags/py/" rel="tag">py</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/Blog/2023/11/28/notes/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          notes
        
      </div>
    </a>
  
  
    <a href="/Blog/2023/11/19/git/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">git</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/Blog/tags/Internet/" rel="tag">Internet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Blog/tags/Javascript/" rel="tag">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Blog/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Blog/tags/algorithm/" rel="tag">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Blog/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Blog/tags/py/" rel="tag">py</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/Blog/tags/Internet/" style="font-size: 10px;">Internet</a> <a href="/Blog/tags/Javascript/" style="font-size: 10px;">Javascript</a> <a href="/Blog/tags/Python/" style="font-size: 20px;">Python</a> <a href="/Blog/tags/algorithm/" style="font-size: 15px;">algorithm</a> <a href="/Blog/tags/git/" style="font-size: 10px;">git</a> <a href="/Blog/tags/py/" style="font-size: 10px;">py</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/Blog/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/Blog/archives/2023/10/">October 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/Blog/2023/11/28/notes/">notes</a>
          </li>
        
          <li>
            <a href="/Blog/2023/11/26/py-Crawler/">py-Crawler</a>
          </li>
        
          <li>
            <a href="/Blog/2023/11/19/git/">git</a>
          </li>
        
          <li>
            <a href="/Blog/2023/11/19/difficulties/">difficulties</a>
          </li>
        
          <li>
            <a href="/Blog/2023/11/15/py-GUI/">py-GUI</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/Blog/" class="mobile-nav-link">Home</a>
  
    <a href="/Blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/Blog/js/jquery-3.6.4.min.js"></script>



  
<script src="/Blog/fancybox/jquery.fancybox.min.js"></script>




<script src="/Blog/js/script.js"></script>





  </div>
</body>
</html>